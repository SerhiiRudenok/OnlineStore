{% extends 'myapp/template.html' %}
{% load static %}

{% block title %}{{ product.name }} | Інтернет магазин{% endblock %}

{% block content %}
    <div class="product-tabs-nav">
        <button class="back-button">
            <i class="fas fa-arrow-left"></i> Назад
        </button>
        <a href="#about-good" class="tab-link active">Усе про товар</a>
        <a href="{% url 'comment_list' product.id %}" class="tab-link">Відгуки</a>
    </div>

    <div class="product-detail-container container-fluid">
        <div class="product-image-section">
            {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="detail-product-image">
            {% else %}
            <img src="{% static 'myapp/images/no-image.jpg' %}" alt="Фото товару" class="detail-product-image">
            {% endif %}
        </div>
        <div class="product-info-section">
            <h1 class="detail-product-name" id="about-good">{{ product.name }}</h1>
            <div class="product-availability">
                <span class="availability-status">В наявності</span>
            </div>


             <div class="product-rating">
                {% if review_count > 0 %}
                    <span class="rating-text">Оцінка товару: <strong>{{ average_rating|floatformat:1 }}</strong>/5</span>

                    <a href="{% url 'comment_list' product.id %}" class="review-count-link">
                        {{ review_count_text }}
                    </a>

                    <div class="rating-stars">
                        {% with rounded_rating=average_rating|floatformat:0|add:0 %}
                            {% for _ in ""|ljust:rounded_rating %}⭐{% endfor %}
                        {% endwith %}
                    </div>
                {% else %}
                    <span class="no-reviews-text">Відгуків поки немає</span>
                {% endif %}
            </div>


            <div class="detail-product-price">{{ product.price }} грн</div>
            <div class="product-actions">
                {% if user.groups.all|length > 0 %}
                    {% for group in user.groups.all %}
                        {% if group.name == "Manager" %}
                            <div class="product-actions">
                                <a href="{% url 'product_update' product.pk %}" class="universal-btn orange-outline-btn">Редагувати товар</a>
                                <a href="{% url 'product_delete' product.pk %}" class="universal-btn danger-filled-btn">Видалити товар</a>
                            </div>
                        {% elif group.name == "Client" %}
                            {% if is_in_cart %}
                                <a href="{% url 'booking_detail' %}" class="universal-btn back-btn">Товар в кошику</a>
                            {% else %}
                                <div class="product-actions">
                                    <button class="add-to-cart-btn universal-btn orange-filled-btn" data-product-id="{{ product.id }}">
                                        Додати в кошик
                                    </button>
                                    <a href="{% url 'booking_detail' %}" class="universal-btn back-btn d-none">Товар в кошику</a>

                                    <button class="add-to-wishlist-btn" data-product-id="{{ product.id }}">
                                        <i class="fas fa-heart"></i>
                                    </button>
                                </div>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                {% endif %}

                {% if user.is_authenticated %}
                    <form method="post" action="{% url 'favorite_product' product.pk %}">
                    {% csrf_token %}
                        <button type="submit" class="add-to-wishlist-btn">
                            <i class="{% if is_favorite %}fas{% else %}far{% endif %} fa-heart"></i>
                        </button>
                    </form>
                {% else %}
                    <button class="add-to-wishlist-btn"><i class="far fa-heart"></i></button>
                {% endif %}
            </div>
            <div class="product-description-container">
                <h2>Опис</h2>
                <p>{{ product.description }}</p>
            </div>
            <div class="product-specs-container">
                <h2 id="characteristics">Характеристики</h2>
                <ul class="product-specs">
                    <li><strong>Категорія:</strong>
                        <a href="{% url 'product_list' %}?category={{ product.category.id }}" class="category-link">
                            {{ product.category.name }}
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
{% endblock %}